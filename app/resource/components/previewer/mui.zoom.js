!function(k,o){var t=k.className("zoom"),e=k.className("zoom-scroller"),A="."+t,H="."+e,W="pinchstart",D="pinch",q="pinchend";"ongesturestart"in o&&(W="gesturestart",D="gesturechange",q="gestureend"),k.Zoom=function(o,t){var r=this;r.options=k.extend(k.Zoom.defaults,t),r.wrapper=r.element=o,r.scroller=o.querySelector(H),r.scrollerStyle=r.scroller&&r.scroller.style,r.zoomer=o.querySelector(A),r.zoomerStyle=r.zoomer&&r.zoomer.style,r.init=function(){k.options.gestureConfig.pinch=!0,k.options.gestureConfig.doubletap=!0,r.initEvents()},r.initEvents=function(o){var t=o?"removeEventListener":"addEventListener",o=r.scroller;o[t](W,r.onPinchstart),o[t](D,r.onPinch),o[t](q,r.onPinchend),o[t]("touchstart",r.onTouchstart),o[t]("touchmove",r.onTouchMove),o[t]("touchcancel",r.onTouchEnd),o[t]("touchend",r.onTouchEnd),o[t]("drag",function(o){(h||s)&&o.stopPropagation()}),o[t]("doubletap",function(o){r.toggleZoom(o.detail.center)})},r.transition=function(o,t){return o.webkitTransitionDuration=(t=t||0)+"ms",r},r.translate=function(o,t,e){return o.webkitTransform="translate3d("+(t=t||0)+"px,"+(e=e||0)+"px,0px)",r},r.scale=function(o,t){return o.webkitTransform="translate3d(0,0,0) scale("+(t=t||1)+")",r},r.scrollerTransition=function(o){return r.transition(r.scrollerStyle,o)},r.scrollerTransform=function(o,t){return r.translate(r.scrollerStyle,o,t)},r.zoomerTransition=function(o){return r.transition(r.zoomerStyle,o)},r.zoomerTransform=function(o){return r.scale(r.zoomerStyle,o)};var a=1,i=1,n=!1,s=!1;r.onPinchstart=function(o){s=!0},r.onPinch=function(o){n||(r.zoomerTransition(0),n=!0),(a=(a=(o.detail||o).scale*i)>r.options.maxZoom?r.options.maxZoom-1+Math.pow(a-r.options.maxZoom+1,.5):a)<r.options.minZoom&&(a=r.options.minZoom+1-Math.pow(r.options.minZoom-a+1,.5)),r.zoomerTransform(a)},r.onPinchend=function(o){a=Math.max(Math.min(a,r.options.maxZoom),r.options.minZoom),r.zoomerTransition(r.options.speed).zoomerTransform(a),i=a,n=!1},r.setZoom=function(o){a=i=o,r.scrollerTransition(r.options.speed).scrollerTransform(0,0),r.zoomerTransition(r.options.speed).zoomerTransform(a)},r.toggleZoom=function(o,t){var e,n;"number"==typeof o&&(t=o,o=void 0),t=void 0===t?r.options.speed:t,a&&1!==a?(a=i=1,r.scrollerTransition(t).scrollerTransform(0,0)):(a=i=r.options.maxZoom,o?(n=(e=k.offset(r.zoomer)).top,e=e.left,e=(o.x-e)*a,n=(o.y-n)*a,this._cal(),T<=e&&e<=T+m||e<T?e=T-e+m/2:T+m<e&&(e=T+m-e-m/2),M<=n&&n<=M+c||n<M?n=M-n+c/2:M+c<n&&(n=M+c-n-c/2),e=Math.min(Math.max(e,p),T),n=Math.min(Math.max(n,d),M),r.scrollerTransition(t).scrollerTransform(e,n)):r.scrollerTransition(t).scrollerTransform(0,0)),r.zoomerTransition(t).zoomerTransform(a)},r._cal=function(){m=r.wrapper.offsetWidth,c=r.wrapper.offsetHeight,g=r.zoomer.offsetWidth;var o=(x=r.zoomer.offsetHeight)*a;p=Math.min(m/2-g*a/2,0),T=-p,d=Math.min(c/2-o/2,0),M=-d};var m,c,l,h,u,f,p,d,T,M,g,x,z,y,v,w,Z,b,S,E={},P={};return r.onTouchstart=function(o){o.preventDefault(),l=!0,E.x=("touchstart"===o.type?o.targetTouches[0]:o).pageX,E.y=("touchstart"===o.type?o.targetTouches[0]:o).pageY},r.onTouchMove=function(o){var t,e;o.preventDefault(),l&&(h||(m=r.wrapper.offsetWidth,c=r.wrapper.offsetHeight,g=r.zoomer.offsetWidth,x=r.zoomer.offsetHeight,t=k.parseTranslateMatrix(k.getStyles(r.scroller,"webkitTransform")),z=t.x||0,y=t.y||0,r.scrollerTransition(0)),e=x*a,(t=g*a)<m&&e<c||(p=Math.min(m/2-t/2,0),T=-p,d=Math.min(c/2-e/2,0),M=-d,P.x=("touchmove"===o.type?o.targetTouches[0]:o).pageX,P.y=("touchmove"===o.type?o.targetTouches[0]:o).pageY,h||n||!(Math.floor(p)===Math.floor(z)&&P.x<E.x||Math.floor(T)===Math.floor(z)&&P.x>E.x)?(h=!0,u=P.x-E.x+z,f=P.y-E.y+y,u<p&&(u=p+1-Math.pow(p-u+1,.8)),T<u&&(u=T-1+Math.pow(u-T+1,.8)),f<d&&(f=d+1-Math.pow(d-f+1,.8)),M<f&&(f=M-1+Math.pow(f-M+1,.8)),v=v||P.x,b=b||P.y,w=w||k.now(),Z=(P.x-v)/(k.now()-w)/2,S=(P.y-b)/(k.now()-w)/2,Math.abs(P.x-v)<2&&(Z=0),Math.abs(P.y-b)<2&&(S=0),v=P.x,b=P.y,w=k.now(),r.scrollerTransform(u,f)):l=!1))},r.onTouchEnd=function(o){var t,e,n;o.touches.length||(s=!1),l&&h?(h=l=!1,e=u+Z*(t=300),o=f+S*(n=300),0!==Z&&(t=Math.abs((e-u)/Z)),0!==S&&(n=Math.abs((o-f)/S)),n=Math.max(t,n),u=e,f=o,o=x*a,p=Math.min(m/2-g*a/2,0),T=-p,d=Math.min(c/2-o/2,0),M=-d,u=Math.max(Math.min(u,T),p),f=Math.max(Math.min(f,M),d),r.scrollerTransition(n).scrollerTransform(u,f)):h=l=!1},r.destory=function(){r.initEvents(!0),delete k.data[r.wrapper.getAttribute("data-zoomer")],r.wrapper.setAttribute("data-zoomer","")},r.init(),r},k.Zoom.defaults={speed:300,maxZoom:3,minZoom:1},k.fn.zoom=function(e){var n=[];return this.each(function(){var o=null,t=this.getAttribute("data-zoomer");t?o=k.data[t]:(t=++k.uuid,k.data[t]=o=new k.Zoom(this,e),this.setAttribute("data-zoomer",t)),n.push(o)}),1===n.length?n[0]:n}}(mui,window);